# Автоматическая деактивация просроченных товаров

## Описание

Команда `deactivate_expired_items` автоматически деактивирует товары с истекшим сроком годности и истекшие предложения.

## Ручной запуск

Для ручного запуска команды используйте:

```bash
python manage.py deactivate_expired_items
```

или

```bash
python3 manage.py deactivate_expired_items
```

## Автоматический запуск через Cron

Чтобы автоматически проверять и деактивировать товары каждый день в 00:01, добавьте задачу в crontab:

### 1. Откройте crontab для редактирования:

```bash
crontab -e
```

### 2. Добавьте следующую строку:

```bash
1 0 * * * cd /Users/humoyunswe/Desktop/foodsave && /usr/bin/python3 manage.py deactivate_expired_items >> /tmp/deactivate_expired.log 2>&1
```

Эта задача будет:
- Запускаться каждый день в 00:01
- Выполнять команду деактивации
- Сохранять лог в файл `/tmp/deactivate_expired.log`

### 3. Сохраните и закройте редактор

В Vim: нажмите `Esc`, затем введите `:wq` и нажмите `Enter`

### 4. Проверьте установленные задачи:

```bash
crontab -l
```

## Альтернативный вариант - несколько раз в день

Если хотите запускать проверку чаще (например, каждые 6 часов):

```bash
0 */6 * * * cd /Users/humoyunswe/Desktop/foodsave && /usr/bin/python3 manage.py deactivate_expired_items >> /tmp/deactivate_expired.log 2>&1
```

Или каждый час:

```bash
0 * * * * cd /Users/humoyunswe/Desktop/foodsave && /usr/bin/python3 manage.py deactivate_expired_items >> /tmp/deactivate_expired.log 2>&1
```

## Просмотр логов

Для просмотра логов выполнения команды:

```bash
cat /tmp/deactivate_expired.log
```

Или для постоянного отслеживания:

```bash
tail -f /tmp/deactivate_expired.log
```

## Что делает команда

Команда:
1. Находит все активные товары с полем `expiry_date` меньше текущей даты
2. Деактивирует их (устанавливает `is_active = False`)
3. Находит все активные предложения (Offer) с `end_date` меньше текущей даты
4. Деактивирует их и устанавливает статус `expired`
5. Выводит количество деактивированных товаров и предложений

## Примеры вывода

**Когда есть просроченные товары:**
```
✅ Деактивировано 5 просроченных товаров
  - Хлеб белый (срок: 2025-10-08) от Магнум
  - Молоко (срок: 2025-10-09) от Small&Fresh
  ...
✅ Деактивировано 3 истекших предложений
```

**Когда нет просроченных товаров:**
```
⚠️  Просроченных товаров не найдено
✅ Деактивировано 0 истекших предложений
```


